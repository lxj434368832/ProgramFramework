#include "PbMessageFactory.h"
#include "../../Framework/include/LogFile.h"
#include "../../3rdParty/protobuf/include/Message.pb.h"

SDataExchange* PbMessageFactory::CreateMsgStruct(unsigned eMsgType, const char* data, unsigned length)
{
	SDataExchange *pData = nullptr;

	switch (eMsgType)
	{
	case pbmsg::ELoginRs:
		pData = new SRespondMsg;
		break;
	case pbmsg::ELogoutRq:
		break;
	default:
		loge() << "不能处理的消息类型:" << (int)eMsgType;
		break;
	}
	
	if (nullptr == pData) return pData;

	if (false == pData->ParseFromPb(data, length))
	{
		loge() << "解析eMsgType:" << eMsgType << " 的protobuf消息失败！";
		delete pData;
		pData = nullptr;
	}
	return pData;
}
